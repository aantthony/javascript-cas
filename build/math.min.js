/**
 *  Math JavaScript Library v3.0.0
 *  https://github.com/aantthony/javascript-cas
 *  
 * Copyright 2010 Anthony Foster. All rights reserved.
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */(function(e){"use strict";function n(e){var t=(new Error(e)).stack;if(!t)return console.warn("Deprecated: "+e);console.warn(t.replace(/^Error\: /,"Deprecated: "))}function s(t){function i(e,t,i){var s=[t,r++,i];if(typeof e=="object")for(var o=0;o<e.length;o++)n[e[o]]=s;else n[e]=s}var n={},r=0;t.forEach(function(t){i(t[0],t[1]||w,t[2]===e?2:t[2])}),this.operators=n,s.build.call(this)}function l(){}function h(e,t){var n=S.parse(e,t);return n}function d(e,t){this.A=e||[],this.m=t||[]}function v(e){return e.__proto__=v.prototype,e}function m(e){}function T(e,t){return new h.Conditional(e.cond,t(e.a),t(e.b))}function N(e){this.x=e}function C(e){this.x=e}function M(e,t){this.pre=[]||t,this.s=e,this.vars=0,this.p=Infinity}function H(e,t){var n=h(e,t||H.Global);return n}var t,r=new Date,i=String.fromCharCode(215);t=s.prototype,t.precedence=function(e){if(!this.operators[e])throw"Precedence of "+e+" not known!";return this.operators[e][1]},t.postfix=function(e){var t=this.operators[e];return t[0]===0&&t[2]===1},t.unary=function(e){var t=["+","-","±"];return t.indexOf(e)!=-1?"@"+e:!1},t.assoc=function(e){return this.operators[e][1]===!0},t.Number=function(e){var t={0:u.Zero,1:u.One};if(t[e])return t[e];if(/^[\d]+$/.test(e))return new h.Integer(Number(e));if(/^[\d]*\.[\d]+$/.test(e)){var n=e.indexOf("."),r=e.length-n-1,i=Math.pow(10,r),s=Number(e.replace(".",""));return(new h.Rational(s,i)).reduce()}return t[e]||new h.NumericalReal(Number(e))};var o={};o.Number=function(e){var t={0:u.Zero,1:u.One};if(t[e])return t[e];if(/^[\d]+$/.test(e))return new h.Integer(Number(e));if(/^[\d]*\.[\d]+$/.test(e)){var n=e.indexOf("."),r=e.length-n-1,i=Math.pow(10,r),s=Number(e.replace(".",""));return(new h.Rational(s,i)).reduce()}return t[e]||new h.NumericalReal(Number(e))},o.String=function(e){return e};var u={},f=function(){function n(){this.yy={}}var e={trace:function(){},yy:{},symbols_:{error:2,expressions:3,e:4,EOF:5,s:6,"+":7,"-":8,"*":9,"/":10,"^":11,"!":12,"%":13,"(":14,")":15,FRAC:16,"{":17,"}":18,NUMBER:19,E:20,PI:21,"=":22,"&&":23,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"+",8:"-",9:"*",10:"/",11:"^",12:"!",13:"%",14:"(",15:")",16:"FRAC",17:"{",18:"}",19:"NUMBER",20:"E",21:"PI",22:"=",23:"&&"},productions_:[0,[3,2],[3,2],[4,3],[4,3],[4,3],[4,2],[4,3],[4,3],[4,2],[4,2],[4,2],[4,3],[4,7],[4,1],[4,1],[4,1],[6,3],[6,3]],performAction:function(t,n,r,i,s,a,f){var l=a.length-1;switch(s){case 1:return a[l-1];case 2:return a[l-1];case 3:this.$=a[l-2]["+"](a[l]);break;case 4:this.$=a[l-2]["-"](a[l]);break;case 5:this.$=a[l-2]["*"](a[l]);break;case 6:this.$=a[l-1].default(a[l]);break;case 7:this.$=a[l-2]["/"](a[l]);break;case 8:this.$=a[l-2]["^"](a[l]);break;case 9:this.$=a[l-1].factorial();break;case 10:this.$=a[l-1]["%"]();break;case 11:this.$=a[l]["@-"]();break;case 12:this.$=a[l-1];break;case 13:this.$=a[l-4]["/"](a[l-1]);break;case 14:this.$=o.Number(t);break;case 15:this.$=u.e;break;case 16:this.$=u.pi;break;case 17:this.$=a[l-2]["="](a[l]);break;case 18:this.$=a[l-2]["&&"](a[l])}},table:[{3:1,4:2,6:3,8:[1,4],14:[1,5],16:[1,6],19:[1,7],20:[1,8],21:[1,9]},{1:[3]},{4:14,5:[1,10],7:[1,11],8:[1,12],9:[1,13],10:[1,15],11:[1,16],12:[1,17],13:[1,18],14:[1,5],16:[1,6],19:[1,7],20:[1,8],21:[1,9],22:[1,19]},{5:[1,20],23:[1,21]},{4:22,8:[1,4],14:[1,5],16:[1,6],19:[1,7],20:[1,8],21:[1,9]},{4:23,8:[1,4],14:[1,5],16:[1,6],19:[1,7],20:[1,8],21:[1,9]},{17:[1,24]},{5:[2,14],7:[2,14],8:[2,14],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],16:[2,14],18:[2,14],19:[2,14],20:[2,14],21:[2,14],22:[2,14],23:[2,14]},{5:[2,15],7:[2,15],8:[2,15],9:[2,15],10:[2,15],11:[2,15],12:[2,15],13:[2,15],14:[2,15],15:[2,15],16:[2,15],18:[2,15],19:[2,15],20:[2,15],21:[2,15],22:[2,15],23:[2,15]},{5:[2,16],7:[2,16],8:[2,16],9:[2,16],10:[2,16],11:[2,16],12:[2,16],13:[2,16],14:[2,16],15:[2,16],16:[2,16],18:[2,16],19:[2,16],20:[2,16],21:[2,16],22:[2,16],23:[2,16]},{1:[2,1]},{4:25,8:[1,4],14:[1,5],16:[1,6],19:[1,7],20:[1,8],21:[1,9]},{4:26,8:[1,4],14:[1,5],16:[1,6],19:[1,7],20:[1,8],21:[1,9]},{4:27,8:[1,4],14:[1,5],16:[1,6],19:[1,7],20:[1,8],21:[1,9]},{4:14,5:[2,6],7:[1,11],8:[1,12],9:[1,13],10:[1,15],11:[1,16],12:[1,17],13:[1,18],14:[1,5],15:[2,6],16:[1,6],18:[2,6],19:[1,7],20:[1,8],21:[1,9],22:[2,6],23:[2,6]},{4:28,8:[1,4],14:[1,5],16:[1,6],19:[1,7],20:[1,8],21:[1,9]},{4:29,8:[1,4],14:[1,5],16:[1,6],19:[1,7],20:[1,8],21:[1,9]},{5:[2,9],7:[2,9],8:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[2,9],16:[2,9],18:[2,9],19:[2,9],20:[2,9],21:[2,9],22:[2,9],23:[2,9]},{5:[2,10],7:[2,10],8:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[2,10],16:[2,10],18:[2,10],19:[2,10],20:[2,10],21:[2,10],22:[2,10],23:[2,10]},{4:30,8:[1,4],14:[1,5],16:[1,6],19:[1,7],20:[1,8],21:[1,9]},{1:[2,2]},{4:32,6:31,8:[1,4],14:[1,5],16:[1,6],19:[1,7],20:[1,8],21:[1,9]},{4:14,5:[2,11],7:[2,11],8:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[1,5],15:[2,11],16:[1,6],18:[2,11],19:[1,7],20:[1,8],21:[1,9],22:[2,11],23:[2,11]},{4:14,7:[1,11],8:[1,12],9:[1,13],10:[1,15],11:[1,16],12:[1,17],13:[1,18],14:[1,5],15:[1,33],16:[1,6],19:[1,7],20:[1,8],21:[1,9]},{4:34,8:[1,4],14:[1,5],16:[1,6],19:[1,7],20:[1,8],21:[1,9]},{4:14,5:[2,3],7:[2,3],8:[2,3],9:[1,13],10:[1,15],11:[1,16],12:[1,17],13:[1,18],14:[1,5],15:[2,3],16:[1,6],18:[2,3],19:[1,7],20:[1,8],21:[1,9],22:[2,3],23:[2,3]},{4:14,5:[2,4],7:[2,4],8:[2,4],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[1,5],15:[2,4],16:[1,6],18:[2,4],19:[1,7],20:[1,8],21:[1,9],22:[2,4],23:[2,4]},{4:14,5:[2,5],7:[2,5],8:[2,5],9:[2,5],10:[2,5],11:[1,16],12:[1,17],13:[1,18],14:[1,5],15:[2,5],16:[1,6],18:[2,5],19:[1,7],20:[1,8],21:[1,9],22:[2,5],23:[2,5]},{4:14,5:[2,7],7:[2,7],8:[2,7],9:[2,7],10:[2,7],11:[1,16],12:[1,17],13:[1,18],14:[1,5],15:[2,7],16:[1,6],18:[2,7],19:[1,7],20:[1,8],21:[1,9],22:[2,7],23:[2,7]},{4:14,5:[2,8],7:[2,8],8:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[1,17],13:[1,18],14:[1,5],15:[2,8],16:[1,6],18:[2,8],19:[1,7],20:[1,8],21:[1,9],22:[2,8],23:[2,8]},{4:14,5:[2,17],7:[1,11],8:[1,12],9:[1,13],10:[1,15],11:[1,16],12:[1,17],13:[1,18],14:[1,5],16:[1,6],19:[1,7],20:[1,8],21:[1,9],23:[2,17]},{5:[2,18],23:[2,18]},{4:14,7:[1,11],8:[1,12],9:[1,13],10:[1,15],11:[1,16],12:[1,17],13:[1,18],14:[1,5],16:[1,6],19:[1,7],20:[1,8],21:[1,9],22:[1,19]},{5:[2,12],7:[2,12],8:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],16:[2,12],18:[2,12],19:[2,12],20:[2,12],21:[2,12],22:[2,12],23:[2,12]},{4:14,7:[1,11],8:[1,12],9:[1,13],10:[1,15],11:[1,16],12:[1,17],13:[1,18],14:[1,5],16:[1,6],18:[1,35],19:[1,7],20:[1,8],21:[1,9]},{17:[1,36]},{4:37,8:[1,4],14:[1,5],16:[1,6],19:[1,7],20:[1,8],21:[1,9]},{4:14,7:[1,11],8:[1,12],9:[1,13],10:[1,15],11:[1,16],12:[1,17],13:[1,18],14:[1,5],16:[1,6],18:[1,38],19:[1,7],20:[1,8],21:[1,9]},{5:[2,13],7:[2,13],8:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],16:[2,13],18:[2,13],19:[2,13],20:[2,13],21:[2,13],22:[2,13],23:[2,13]}],defaultActions:{10:[2,1],20:[2,2]},parseError:function(t,n){throw new Error(t)},parse:function(t){function v(e){r.length=r.length-2*e,i.length=i.length-e,s.length=s.length-e}function m(){var e;return e=n.lexer.lex()||1,typeof e!="number"&&(e=n.symbols_[e]||e),e}var n=this,r=[0],i=[null],s=[],o=this.table,u="",a=0,f=0,l=0,c=2,h=1;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,typeof this.lexer.yylloc=="undefined"&&(this.lexer.yylloc={});var p=this.lexer.yylloc;s.push(p);var d=this.lexer.options&&this.lexer.options.ranges;typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);var g,y,b,w,E,S,x={},T,N,C,k;for(;;){b=r[r.length-1];if(this.defaultActions[b])w=this.defaultActions[b];else{if(g===null||typeof g=="undefined")g=m();w=o[b]&&o[b][g]}if(typeof w=="undefined"||!w.length||!w[0]){var L="";if(!l){k=[];for(T in o[b])this.terminals_[T]&&T>2&&k.push("'"+this.terminals_[T]+"'");this.lexer.showPosition?L="Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+k.join(", ")+", got '"+(this.terminals_[g]||g)+"'":L="Parse error on line "+(a+1)+": Unexpected "+(g==1?"end of input":"'"+(this.terminals_[g]||g)+"'"),this.parseError(L,{text:this.lexer.match,token:this.terminals_[g]||g,line:this.lexer.yylineno,loc:p,expected:k})}}if(w[0]instanceof Array&&w.length>1)throw new Error("Parse Error: multiple actions possible at state: "+b+", token: "+g);switch(w[0]){case 1:r.push(g),i.push(this.lexer.yytext),s.push(this.lexer.yylloc),r.push(w[1]),g=null,y?(g=y,y=null):(f=this.lexer.yyleng,u=this.lexer.yytext,a=this.lexer.yylineno,p=this.lexer.yylloc,l>0&&l--);break;case 2:N=this.productions_[w[1]][1],x.$=i[i.length-N],x._$={first_line:s[s.length-(N||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(N||1)].first_column,last_column:s[s.length-1].last_column},d&&(x._$.range=[s[s.length-(N||1)].range[0],s[s.length-1].range[1]]),S=this.performAction.call(x,u,f,a,this.yy,w[1],i,s);if(typeof S!="undefined")return S;N&&(r=r.slice(0,-1*N*2),i=i.slice(0,-1*N),s=s.slice(0,-1*N)),r.push(this.productions_[w[1]][0]),i.push(x.$),s.push(x._$),C=o[r[r.length-2]][r[r.length-1]],r.push(C);break;case 3:return!0}}return!0}},t=function(){var e={EOF:1,parseError:function(t,n){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,n)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var i=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===r.length?this.yylloc.first_column:0)+r[r.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=(new Array(e.length+1)).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,r,i,s;this._more||(this.yytext="",this.match="");var o=this._currentRules();for(var u=0;u<o.length;u++){n=this._input.match(this.rules[o[u]]);if(n&&(!t||n[0].length>t[0].length)){t=n,r=u;if(!this.options.flex)break}}if(t){s=t[0].match(/(?:\r\n?|\n).*/g),s&&(this.yylineno+=s.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:s?s[s.length-1].length-s[s.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,o[r],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1);if(e)return e;return}return this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return typeof t!="undefined"?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)}};return e.options={},e.performAction=function(t,n,r,i){var s=i;switch(r){case 0:break;case 1:return 19;case 2:return 22;case 3:return 9;case 4:return 10;case 5:return 8;case 6:return 7;case 7:return 23;case 8:return 11;case 9:return 12;case 10:return 13;case 11:return 14;case 12:return 15;case 13:return 17;case 14:return 18;case 15:return 21;case 16:return 20;case 17:return 16;case 18:return 5;case 19:return"INVALID"}},e.rules=[/^(?:\s+)/,/^(?:[0-9]+(\.[0-9]+)?\b)/,/^(?:=)/,/^(?:\*)/,/^(?:\/)/,/^(?:-)/,/^(?:\+)/,/^(?:&&)/,/^(?:\^)/,/^(?:!)/,/^(?:%)/,/^(?:\()/,/^(?:\))/,/^(?:\{)/,/^(?:\})/,/^(?:PI\b)/,/^(?:E\b)/,/^(?:\\frac\b)/,/^(?:$)/,/^(?:.)/],e.conditions={INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],inclusive:!0}},e}();return e.lexer=t,n.prototype=e,e.Parser=n,new n}();typeof require!="undefined"&&typeof exports!="undefined"&&(exports.parser=f,exports.Parser=f.Parser,exports.parse=function(){return f.parse.apply(f,arguments)},exports.main=function(t){if(!t[1])throw new Error("Usage: "+t[0]+" FILE");var n,r;return typeof process!="undefined"?n=require("fs").readFileSync(require("path").resolve(t[1]),"utf8"):n=require("file").path(require("file").cwd()).join(t[1]).read({charset:"utf-8"}),exports.parser.parse(n)},typeof module!="undefined"&&require.main===module&&exports.main(typeof process!="undefined"?process.argv.slice(1):require("system").args)),t=l.prototype=Object.create(u),t.reset=function(){this.splice(0)},t.impliesExpression=function(e){return!1},t.learn=function(e){this.equations.push(e)},s.build=function(){this.parse=function(t,n){if(t==="")return e;console.log("parsing: ",t);var r=f.parse(t);return r;var i}},window.calc=f,t=h.prototype,t.valueOf=null,t.identity=function(){return n("Slow"),this},t.toString=null,t.imageURL=function(){return"http://latex.codecogs.com/gif.latex?"+encodeURIComponent(this.s("text/latex").s)},t.image=function(){var e=new Image;return e.src=this.imageURL(),e},t.sub=function(){return this},t.lim=function(e,t){return this.sub(e,t)},t[","]=function(e){return e instanceof h.Statement?new h.Conditional(e,this):h.Vector([this,e])},t["="]=function(e){return new h.Statement(this,e,"=")},t["!="]=function(e){return new h.Statement(this,e,"!=")},t[">"]=function(e){return new h.Statement(this,e,">")},t[">="]=function(e){return new h.Statement(this,e,">=")},t["<"]=function(e){return new h.Statement(this,e,"<")},t["<="]=function(e){return new h.Statement(this,e,"<=")},t["*"]=function(e){return e===u.Zero?e:e===u.One?this:new h.List([this,e],"*")},t[i]=function(e){return this["*"](e)},t.default=function(e){return this["*"](e)},t["/"]=function(e){return new h.List([this,e],"/")},t["+"]=function(e){return new h.List([this,e],"+")},t["-"]=function(e){return new h.List([this,e],"-")},t["@-"]=function(e){return new h.List([this],"@-")},t["^"]=function(e){return new h.List([this,e],"^")},t["%"]=function(e){return new h.List([this,e],"%")},h.List=function(e,t){return e.__proto__=h.List.prototype,e.operator=t,e},t=h.List.prototype=Object.create(t),t.constructor=h.List,t.sub=function(e,t){var n=this[0].sub(e,t);if(this.length===1)return n[this.operator]();var r=this[1].sub(e,t);return n[this.operator||"default"](r)},t["@-"]=function(){return this.operator==="@-"?this[0]:new h.List([this],"@-")},t=d.prototype,t.add=function(e){var t=this.A.indexOf(e);if(t===-1){var n=this.length;this.A[n]=e,this.m[n]=1}else this.m[t]++;return this},t.remove=function(e){var t=this.A.indexOf(e);return this.m[t]--,this},t.intersect=function(e){throw"What is multiset intersection?"},t.map=function(e){return d(Array.prototype.map.call(this.A,e),this.m)},d.fromArray=function(e){throw"NYI";var t,n},t=v.prototype,t.intersect=function(e){var t,n=this.length,r,i=e.length,s=new v([]);for(t=0;t<n;t++)for(r=0;r<i;r++){var o=this[t],a=e[r];if(o===a){s[s.length]=o;break}var f=o["-"](a);if(f===u.Zero){s[s.length]=o;break}}return o},t.union=function(e){return v(Array.prototype.concat.call(this,e))},t.remove=function(e){var t=this.indexOf(e);return this[t]=this[this.length-1],this.length--,this},t.add=function(e){return this.indexOf(e)===-1&&(this[this.length]=e),this},t.map=function(e){return v(Array.prototype.map.call(this,e))},t.compose=function(e){},t.cardinality=function(){return this.length},m.aleph_0={">":function(e){if(e instanceof h.NumericalReal)return h.True}},t=m.prototype=Object.create(v.prototype),t.cardinality=function(){return m.cardinality},h.TruthValue=function(t){},t=h.TruthValue.prototype=Object.create(h.prototype),h.True=new h.TruthValue,h.False=new h.TruthValue,h.False["~"]=function(){return h.True},t["~"]=function(){return h.False},t.V=function(e){return e===h.True?e:this},t["^"]=function(e){return e===h.True?this:e},h.Statement=function(e,t,n){var r=[e,t];return r.operator=n,r.__proto__=h.Statement.prototype,r},t=h.Statement.prototype=Object.create(h.prototype),t.constructor=h.Statement,t["="]=function(){},t["<"]=function(){},t.solve=function(e){var t=this.a["-"](this.b);return t.roots(e)};var g,b,w=g=0,E=b=1,S=new s([[";"],[","],[["=","+=","-=","*=","/=","%=","&=","^=","|="],E],[["?",":"],E,2],[["∨"]],[["&&"]],[["|"]],[["??????"]],[["&"]],[["==","≠","!==","==="]],[["<","<=",">",">="],w],[[">>","<<"]],["±",E,2],[["+"],!0],[["-"],w],[["∫","∑"],E,1],[["*","%"],E],[i,E],[["@+","@-","@±"],E,1],[["¬"],w,1],["default",E,2],["∘",E,2],[["/"]],[["^"]],["!",w,1],[["~"],E,1],[["++","++",".","->"],w,1],[["::"]],[["_"],w,2],["var",E,1],["break",E,0],["throw",E,1],["'",w,1],["√",E,1],["#",E,1]]),x=new s([[";"],[","],[["=","+="]]]);h.Constant=function(){throw new Error("Expression.Constant created directly")},t=h.Constant.prototype=Object.create(h.prototype),t.simplify=function(){return this},t.differentiate=function(){return u.Zero},t.default=function(e){return this["*"](e)},h.Symbol=function(t){this.symbol=t},t=h.Symbol.prototype=Object.create(h.prototype),t.constructor=h.Symbol,t.differentiate=function(e){return this===e?u.One:u.Zero},t.integrate=function(e){return this===e?(new h.NumericalReal(.5,0))["*"](e["^"](new h.NumericalReal(2,0))):this["*"](e)},t.sub=function(e,t){return this===e?t:this},h.Symbol.Real=function(t){this.symbol=t},t=h.Symbol.Real.prototype=Object.create(h.Symbol.prototype),t.constructor=h.Symbol.Real,t.realimag=function(){return h.List.ComplexCartesian([this,u.Zero])},t.real=function(){return this},t.imag=function(){return u.Zero},t.polar=function(){return h.List.ComplexPolar([h.List.Real([u.abs,this]),h.List.Real([u.arg,this])])},t.abs=function(){return h.List.Real([u.abs,this])},t.arg=function(){return h.List.Real([u.arg,this])},t["+"]=function(e){return e==u.Zero?this:e instanceof h.NumericalReal?new h.List.Real([this,e],"+"):e instanceof h.Symbol.Real?new h.List.Real([this,e],"+"):e instanceof h.Symbol?new h.List([this,e],"+"):e["+"](this)},t["-"]=function(e){return this===e?u.Zero:e instanceof h.Symbol.Real?new h.List.Real([this,e],"-"):e instanceof h.List.Real?e.operator==="@-"?new h.List.Real([this,e[0]],"+"):new h.List.Real([this,e],"-"):e instanceof h.Symbol?new h.List([this,e],"-"):e["@-"]()["+"](this)},t["@+"]=function(e){return h.List.Real([this],"@+")},t["@-"]=function(e){return h.List.Real([this],"@-")},t["*"]=function(e){return e instanceof h.Rational&&e.a===e.b?this:e instanceof h.Rational&&e.a===0?u.Zero:e instanceof h.Symbol.Real?new h.List.Real([this,e],"*"):e instanceof h.List.Real?e["*"](this):e instanceof h.Symbol?new h.List([this,e],"*"):e instanceof h.NumericalReal?new h.List.Real([e,this],"*"):e instanceof h.NumericalComplex?new h.List.Real([this,e],"*"):e instanceof h.List.ComplexCartesian?e["*"](this):e["*"](this)},t.default=t["*"],t["/"]=function(e){if(e instanceof h.Rational&&e.a===e.b)return this;if(e instanceof h.Rational&&e.a===0)throw"Division by zero";return h.List.Real([this,e],"/")},t["^"]=function(e){if(e instanceof h.Rational&&e.a===0)return u.One;if(e instanceof h.Rational&&e.a===e.b)return this;if(e instanceof h.Integer)return h.List.Real([this,e],"^");if(e instanceof h.Rational){var t=e.reduce();if(t.a%2===0)return h.List.Real([this,e],"^")}return h.List([this,e],"^")},t["%"]=function(e){return h.List.Real([this,e],"%")},t.apply=function(t,n){throw"Real.apply"},h.Function=function(e){this.default=e.default,this["text/latex"]=e["text/latex"],this["x-shader/x-fragment"]=e["x-shader/x-fragment"],this["text/javascript"]=e["text/javascript"],this.derivative=e.derivative,this.realimag=e.realimag},t=h.Function.prototype=Object.create(h.prototype),t.constructor=h.Function,t.default=function(e){return},t.differentiate=function(){if(this.derivative)return this.derivative;throw"Function has no derivative defined."},t.s=function(e){if(this[e])return new M(this[e]);throw"Could not compile function into "+e},t["+"]=function(e){var t=new h.Symbol;return new h.Function.Symbolic(this.default(t)["+"](e),[t])},t["@-"]=function(e){var t=new h.Symbol;return new h.Function.Symbolic(this.default(t)["@-"](),[t])},h.Function.Symbolic=function(t,n){this.expr=t,this.symbols=n},t=h.Function.Symbolic.prototype=Object.create(h.Function.prototype),t.constructor=h.Function.Symbolic,t.default=function(e){e.constructor!==h.Vector&&(e=h.Vector([e]));var t=this.expr,n,r=this.symbols.length;if(r!==e.length)throw"Invalid domain. Element of F^"+r+" expected.";for(n=0;n<r;n++)t=t.sub(this.symbols[n],e[n]);return t},h.NumericalComplex=function(e,t){this._real=e,this._imag=t},t=h.NumericalComplex.prototype=Object.create(h.Constant.prototype),t.constructor=h.NumericalComplex,t.real=function(){return new h.NumericalReal(this._real)},t.imag=function(){return new h.NumericalReal(this._imag)},t.realimag=function(){return h.List.ComplexCartesian([new h.NumericalReal(this._real),new h.NumericalReal(this._imag)])},t.conjugate=function(){return new h.NumericalComplex(this._real,-this._imag)},t["+"]=function(e){if(this._real===0&&this._imag===0)return e;if(e instanceof h.NumericalComplex)return new h.NumericalComplex(this._real+e._real,this._imag+e._imag);if(e instanceof h.NumericalReal)return new h.NumericalComplex(this._real+e.value,this._imag);if(e.constructor===h.List.ComplexCartesian)return e["+"](this);if(e.constructor===h.List.ComplexPolar)return e["+"](this);if(e.constructor===h.List.Real)return e["+"](this);if(e.constructor===h.Symbol.Real)return e["+"](this);if(e.constructor===h.List)return e["+"](this);throw"Unknown Type for NumericalComplex +"},t["-"]=function(e){if(this._real===0&&this._imag===0)return e["@-"]();if(e instanceof h.NumericalComplex)return new h.NumericalComplex(this._real-e._real,this._imag-e._imag);if(e.constructor===h.NumericalReal)return new h.NumericalComplex(this._real-e.value,this._imag);if(e.constructor===h.List.ComplexCartesian)return e["@-"]()["+"](this);if(e.constructor===h.List.ComplexPolar)return e["@-"]()["+"](this);if(e.constructor===h.List.Real)return e["@-"]()["+"](this);if(e.constructor===h.Symbol.Real)return e["@-"]()["+"](this);if(e.constructor===h.List)return e["@-"]()["+"](this);throw"Unknown Type for NumericalComplex -"},t["*"]=function(e){if(this._imag===0){if(this._real===0)return u.Zero;if(this._real===1)return e}if(e.constructor===this.constructor)return new h.NumericalComplex(this._real*e._real-this._imag*e._imag,this._real*e._imag+this._imag*e._real);if(e.constructor===h.NumericalReal)return new h.NumericalComplex(this._real*e.value,this._imag*e.value);if(e.constructor===h.List.ComplexCartesian)return e["*"](this);if(e.constructor===h.List.ComplexPolar)return e["*"](this);if(e.constructor===h.List.Real)return e["*"](this);if(e.constructor===h.Symbol.Real)return e["*"](this);if(e.constructor===h.List)return e["*"](this);throw"Unknown Type for NumericalComplex *"},t["/"]=function(e){if(this._imag===0&&this._real===0)return u.Zero;if(e.constructor===this.constructor){var t=e._real*e._real+e._imag*e._imag;return new h.NumericalComplex((this._real*e._real+this._imag*e._imag)/t,(this._imag*e._real-this._real*e._imag)/t)}if(e.constructor===h.NumericalReal)return new h.NumericalComplex(this._real/e.value,this._imag/e.value);if(e.constructor===h.List.ComplexCartesian)return this.realimag()["/"](e);if(e.constructor===h.List.ComplexPolar)return this.polar()["/"](e);if(e.constructor===h.List.Real)return h.List([this,e],"/");if(e.constructor===h.Symbol.Real)return h.List([this,e],"/");if(e.constructor===h.List)return h.List([this,e],"/");throw"Unknown Type for NumericalComplex /"},t["!"]=function(){return u.Gamma.default(this)},function(){return;var t}(),h.Conditional=function(t,n,r){if(n instanceof h.Symbol.Real||n instanceof h.List.Real)return new h.Conditional.Real(t,n,r);this.cond=t,this.a=n,this.b=r||u.undefined},t=h.Conditional.prototype=Object.create(h.prototype),t.constructor=h.Conditional,t.s=function(e){throw"Not real... too confusing"},t.real=function(e){return T(this,function(e){return e.real()})},t.imag=function(e){return T(this,function(e){return e.imag()})},t.realimag=function(e){return T(this,function(e){return e.realimag()})},t.differentiate=function(e){return T(this,function(t){return t.differentiate(e)})},h.Conditional.Real=function(t,n,r){this.cond=t,this.a=n,this.b=r||u.undefined},t=h.Conditional.Real.prototype=Object.create(h.Conditional.prototype),t.constructor=h.Conditional.Real,t.real=function(){return this},t.imag=function(){return u.Zero},t.realimag=function(){return new h.List.ComplexCartesian([this,u.Zero])},t.s=function(e){e==="text/latex";if(e==="text/javascript"||e=="x-shader/x-fragment"){var t=this.a.s(e),n=this.b.s(e);console.log("code",t,n);var r=this.cond.s(e),i=t.s,s=t.merge(n);return s.merge(r,"("+r.s+") ? "+i+" : "+n.s)}},h.prototype.conjugate=function(){throw"Conjugate"},h.List.prototype.conjugate=function(){var e,t=this.length,n=new Array(t);for(e=0;e<t;e++)n[e]=this[e].conjugate();return h.List(n,this.operator)},h.NumericalReal=function(t){this.value=t},t=h.NumericalReal.prototype=Object.create(h.NumericalComplex.prototype),t.constructor=h.NumericalReal,Object.defineProperty(t,"_real",{get:function(){return this.value}}),t._imag=0,t.real=function(){return this},t.imag=function(){return u.Zero},t.realimag=function(){return h.List.ComplexCartesian([this,u.Zero])},t.conjugate=function(){return this},t["+"]=function(e){return this.value===0?e:e instanceof h.NumericalReal?new h.NumericalReal(this.value+e.value):e["+"](this)},t["@-"]=function(e){return new h.NumericalReal(-this.value)},t["-"]=function(e){return this.value===0?e:e instanceof h.NumericalReal?new h.NumericalReal(this.value-e.value):e["@-"]()["+"](this)},t["%"]=function(e){var t="The modular arithmetic operator '%' is not defined for non-real numbers.";if(this.value===0)return u.Zero;if(e instanceof h.NumericalReal)return new h.NumericalReal(this.value%e.value);if(e.constructor===h.List.Real)return h.List.Real([this,e],"%");if(e.constructor===h.Symbol.Real)return h.List.Real([this,e],"%");throw e.constructor===h.List?"Not sure about this...":e.constructor===h.NumericalComplex?new TypeError(t):e.constructor===h.List.ComplexCartesian?new TypeError(t):e.constructor===h.List.ComplexPolar?new TypeError(t):"Unknown Type for NumericalReal %"},t["*"]=function(e){return e instanceof h.NumericalReal?new h.NumericalReal(this.value*e.value):e["*"](this)},t["/"]=function(e){if(this.value===0)return u.Zero;if(e instanceof h.NumericalReal){if(e.value===0)throw"Division by zero not allowed!";return new h.NumericalReal(this.value/e.value)}if(e.constructor===h.NumericalComplex){var t=e._real*e._real+e._imag*e._imag;return new h.Complex(this.value*e._real/t,-this.value*e._imag/t)}if(e instanceof h.List.ComplexCartesian){var n=h.List.ComplexCartesian([e[0],e[1]["@-"]()]),r=h.NumericalReal(2);return n["*"](this)["/"](e[0]["^"](r)["+"](e[1]["^"](r)))}if(!(e instanceof h.List.ComplexPolar)){if(e instanceof h.List.Real)return h.List.Real([this,e],"/");if(e instanceof h.Symbol.Real)return h.List.Real([this,e],"/");if(e instanceof h.List)return h.List([this,e],"/");throw console.log("Unknown type: ",this,e),"Unknown Type for NumericalReal /"}},t["^"]=function(e){if(this.value===0)return u.Zero;if(this.value===1)return u.One;if(e===u.Zero)return u.One;if(e===u.One)return this;if(e instanceof h.Integer)return new h.NumericalReal(Math.pow(this.value,e.a));if(e instanceof h.NumericalReal){if(this.value>0)return new h.NumericalReal(Math.pow(this.value,e.value));var t=Math.pow(-this.value,e.value),n=Math.PI*e.value;return new h.List.ComplexPolar([new h.NumericalReal(t),new h.NumericalReal(n)])}if(e.constructor===h.NumericalComplex){var r=this.value,i=e._real,s=e._imag;console.error("Bad implementation ( num ^ complex)");var o=.5*Math.log(r*r),a=o*s,f=Math.exp(o*i);return new h.NumericalComplex(f*Math.cos(a),f*Math.sin(a))}if(e.constructor===h.List.ComplexCartesian)return h.List([this,e],"^");if(e.constructor===h.List.ComplexPolar)return h.List([this,e],"^");if(e.constructor===h.List.Real)return this.value>0?h.List.Real([this,e],"^"):h.List([this,e],"^");if(e.constructor===h.Symbol.Real)return this.value>0?h.List.Real([this,e],"^"):h.List([this,e],"^");if(e.constructor===h.List)return h.List([this,e],"^");throw console.error("Unknown Type for NumericalReal ^",e,e instanceof h.NumericalReal)},t[">"]=function(e){if(e instanceof h.NumericalReal)return this.value>e.value?h.True:h.False},t.apply=function(t,n){switch(t){case",":return h.Vector([this,n]);case"^":if(this.value===0)return u.Zero;break;case"+":if(this.value===0)return n;break;case"-":if(this.value===0)return n.apply("@-");break;case e:case"*":if(this.value===1)return n;case"/":if(this.value===0)return u.Zero}if(n===e)switch(t){case"@+":return this;case"@-":return new h.NumericalReal(-this.value);case"++":case"--":throw new TypeError("Postfix "+t+" operator applied to value that is not a reference.");case"+=":case"-=":case"*=":case"/=":throw new ReferenceError("Left side of assignment is not a reference.");case"!":return u.Gamma.apply(e,new h.NumericalReal(this.value+1))}else if(n.constructor===this.constructor)switch(t){case"*":case e:return new h.NumericalReal(this.value*n.value);case"+":return new h.NumericalReal(this.value+n.value);case"-":return new h.NumericalReal(this.value-n.value);case"/":return new h.NumericalReal(this.value/n.value);case"^":if(this.value>0)return new h.NumericalReal(Math.pow(this.value,n.value));var r=Math.pow(-this.value,n.value),i=Math.PI*n.value;return new h.Complex(r*Math.cos(i),r*Math.sin(i));default:}else if(n.constructor===h.Complex)switch(t){case"*":case e:return new h.Complex(this.value*n._real,this.value*n._imag);case"+":return new h.Complex(this.value+n._real,n._imag);case"-":return new h.Complex(this.value-n._real,-n._imag);case"/":var s=n._real*n._real+n._imag*n._imag;return new h.Complex(this.value*n._real/s,-this.value*n._imag/s);case"^":var o=this.value,a=n._real,f=n._imag;console.error("Bad implementation ( num ^ complex)");var l=.5*Math.log(o*o),c=l*f,p=Math.exp(l*a);return new h.Complex(p*Math.cos(c),p*Math.sin(c));default:}else if(n.constructor===h.List.ComplexCartesian)switch(t){case"+":case"-":return h.List.ComplexCartesian([n[0].apply(t,this),n[1]]);case e:t="*";case"*":case"/":return h.List.ComplexCartesian([n[0].apply(t,this),n[1].apply(t,this)]);case"^":return console.warn("ineffecient: NR ^ CL"),this.realimag().apply(t,n)}else if(n.constructor===h.List
.ComplexPolar)switch(t){case"+":case"-":case"^":return h.List([this,n],t);case e:t="*";case"*":return h.List.ComplexPolar([n[0].apply(t,this),n[1]]);case"/":return h.List.ComplexPolar([n[0].apply(t,this),n[1]])}else if(n.constructor===h.List.Real)switch(t){case e:t="*";case"*":case"+":case"-":case"/":return h.List.Real([this,n],t);case"^":if(this.value===0)throw"N(0) ^ x";return this.value>0?h.List.Real([this,n],t):h.List.ComplexPolar([(new h.Numerical(-this.value)).apply("^",n),u.pi.apply("*",n)])}else if(n.constructor===h.Symbol.Real)switch(t){case e:t="*";case"*":case"+":case"-":case"/":return h.List.Real([this,n],t);case"^":if(this.value===0)throw"N(0) ^ x";return this.value>0?h.List.Real([this,n],t):h.List.ComplexPolar([h.List.Real([new h.NumericalReal(-this.value),n],"^"),u.pi.apply("*",n)])}throw"?? - real"},h.Rational=function(t,n){this.a=t,this.b=n},t=h.Rational.prototype=Object.create(h.NumericalReal.prototype),t.constructor=h.Rational,t.__defineGetter__("value",function(){return this.a/this.b}),t["+"]=function(e){return this.a===0?e:e instanceof h.Rational?new h.Rational(this.a*e.b+this.b*e.a,this.b*e.b):e.constructor===h.NumericalComplex?new h.NumericalComplex(this.value+e._real,e._imag):e.constructor===h.List.ComplexCartesian?e["+"](this):e.constructor===h.List.ComplexPolar?e["+"](this):e.constructor===h.List.Real?e["+"](this):e.constructor===h.Symbol.Real?e["+"](this):e.constructor===h.List?e["+"](this):(console.warn("Swapped operator order for + with Rational"),e["+"](this))},t["-"]=function(e){return this.a===0?e["@-"]():e instanceof h.Rational?new h.Rational(this.a*e.b-this.b*e.a,this.b*e.b):e.constructor===h.NumericalComplex?new h.NumericalComplex(this.value-e._real,e._imag):e.constructor===h.List.ComplexCartesian?e["@-"]()["+"](this):e.constructor===h.List.ComplexPolar?e["@-"]()["+"](this):e.constructor===h.List.Real?e["@-"]()["+"](this):e.constructor===h.Symbol.Real?e["@-"]()["+"](this):e.constructor===h.List?e["@-"]()["+"](this):(console.warn("Swapped operator order for - with Rational"),e["+"](this))},t["*"]=function(e){return this.a===0?u.Zero:e instanceof this.constructor?new h.Rational(this.a*e.a,this.b*e.b):this.__proto__.__proto__["*"].call(this,e)},t["/"]=function(e){if(this.a===0)return u.Zero;if(e instanceof this.constructor){if(e.a===0)throw"Division By Zero is not defined for Rational numbers!";return(new h.Rational(this.a*e.b,this.b*e.a)).reduce()}return h.NumericalReal.prototype["/"].call(this,e)},t["^"]=function(e){if(e===u.Zero)return u.One;if(e===u.One)return this;if(this.a===0)return u.Zero;if(this.a===this.b)return u.One;if(e instanceof h.Integer)return new h.Rational(Math.pow(this.a,e.a),Math.pow(this.b,e.a));if(e instanceof h.Rational){var t=e.reduce();return t.a%2==0?new h.NumericalReal(Math.pow(Math.pow(this.a,t.a),1/t.b)):h.NumericalReal.prototype["^"].call(this,e)}return h.List([this,e],"^")},t.reduce=function(){function e(t,n){return n===0?t:e(n,t%n)}var t=e(this.b,this.a);return this.a/=t,this.b/=t,this.b===1?new h.Integer(this.a):(this.b<0&&(this.a=-this.a,this.b=-this.b),this)},h.Integer=function(t){this.a=t},t=h.Integer.prototype=Object.create(h.Rational.prototype),t.b=1,t.constructor=h.Integer,t["+"]=function(e){return e instanceof h.Integer?new h.Integer(this.a+e.a):e["+"](this)},t["-"]=function(e){return e instanceof h.Integer?new h.Integer(this.a-e.a):this.__proto__.__proto__["-"].call(this,e)},t["/"]=function(e){return e instanceof h.Integer?this.a%e.a===0?new h.Integer(this.a/e.a):new h.Rational(this.a,e.a):this.__proto__.__proto__["/"].call(this,e)},t["@-"]=function(){return new h.Integer(-this.a)},t["*"]=function(e){return e instanceof h.Integer?new h.Integer(this.a*e.a):e["*"](this)},t["^"]=function(e){if(e instanceof h.Integer)return new h.Integer(Math.pow(this.a,e.a));if(e.constructor===h.Rational){var t=e.reduce();return t.a%2==0?new h.NumericalReal(Math.pow(Math.pow(this.a,t.a),1/t.b)):h.NumericalReal.prototype["^"].call(this,e)}if(e.constructor===h.List.Real||e.constructor===h.Symbol.Real)if(this.a>0)return h.List.Real([this,e],"^");return h.NumericalReal.prototype["^"].call(this,e)},t["%"]=function(e){return e instanceof h.Integer?new h.Integer(this.a%e.a):e.constructor===h.Rational?new h.Rational:e.constructor===h.NumericalReal?new h.NumericalReal(this%e.value):h.List.Real([this,e],"%")},h.List.prototype.differentiate=function(t){switch(this.operator){case e:if(this[0]instanceof h.Function){var n=this[1].differentiate(t);return n===u.Zero?n:this[0].differentiate().default(this[1])["*"](n)};case"*":return this[0].differentiate(t)["*"](this[1])["+"](this[1].differentiate(t)["*"](this[0]));case"@+":case"@-":return this[0].differentiate(t)[this.operator]();case"+":case"-":return this[0].differentiate(t)[this.operator](this[1].differentiate(t));case"^":var r=this[0].differentiate(t),i=this[1].differentiate(t);if(r===u.Zero)return i===u.Zero?u.Zero:i["*"](u.log.default(this[0]))["*"](this);var s=this[0]["^"](this[1]["-"](u.One));return s["*"](r["*"](this[1])["+"](this[0]["*"](u.log.default(this[0]))["*"](i)));case"/":var n=this[0].differentiate(t),o=this[1].differentiate(t);if(o===u.Zero)return n["/"](this[1]);return this[1]["*"](n)["-"](this[0]["*"](o))["/"](this[1]["^"](new h.Integer(2)));default:throw"Cannot differentiate "+this.operator+" operator."}},h.prototype.differentiateN=function(e,t){if(t===0)return this;if(t<=-1)return this.integrateN(e,t);if(t>1)return this.differentiate(e).differentiateN(e,t-1);if(t===1)return this.differentiate(e)},h.Root=function(t,n){this.a=t,this.n=n},t=h.Root.prototype=Object.create(h.NumericalReal),t.constructor=h.Root,t["*"]=function(e){if(e.constructor!==this.constructor)return e["*"](this)},t.__defineGetter__("value",function(){return Math.pow(this.a,1/this.n)}),h.Equation=function(e,t){return e.__proto__=h.Equation.prototype,e.operator=t,e},t=h.Equation.prototype=Object.create(h.List.prototype),t.apply=function(e,t){throw"Operators cannot be applied to equations"},h.List.ComplexPolar=function(e){return e.__proto__=h.List.ComplexPolar.prototype,e},t=h.List.ComplexPolar.prototype=Object.create(h.prototype),t.constructor=h.List.ComplexPolar,t.polar=function(){return this},t.realimag=function(){return h.List.ComplexCartesian([this[0].apply("*",u.cos.apply(e,this[1])),this[0].apply("*",u.sin.apply(e,this[1]))])},t.real=function(){return this[0].apply("*",u.cos.apply(e,this[1]))},t.imag=function(){return this[0].apply("*",u.sin.apply(e,this[1]))},t.conjugate=function(){return h.List.ComplexPolar([this[0],this[1].apply("@-")])},t.differentiate=function(e){return u.e.apply("^",u.i.apply("*",this[1])).apply("*",this[0].differentiate(e).apply("+",u.i.apply("*",this[0]).apply("*",this[1].differentiate(e))))},t.apply=function(t,n){if(n.constructor===this.constructor)switch(t){case e:case"*":return h.List.ComplexPolar([this[0].apply("*",n[0]),this[1].apply("+",n[1])]);case"/":return h.List.ComplexPolar([this[0].apply("/",n[0]),this[1].apply("-",n[1])]);case"+":case"-":case"^":case"!":default:}else if(n.constructor===h.NumericalReal)switch(t){case e:case"*":return h.List.ComplexPolar([this[0].apply("*",n),this[1]]);case"/":return h.List.ComplexPolar([this[0].apply("/",n),this[1]]);case"+":case"-":case"^":return h.List.ComplexPolar([this[0],this[1].apply("*",n)]);case"!":default:}else if(n.constructor===h.Complex)switch(t){case e:case"*":return h.List.ComplexPolar([this[0].apply("*",new h.NumericalReal(n._real)),this[1].apply("+",new h.NumericalReal(n._imag))]);case"/":return h.List.ComplexPolar([this[0].apply("/",new h.NumericalReal(n._real)),this[1].apply("-",new h.NumericalReal(n._imag))]);case"+":case"-":case"^":case"!":default:}},t.abs=function(){return this[0]},t.arg=function(){return this[1]},h.prototype.real=function(){return console.warn("TODO: don't calculate both parts (Expression.prototype.real)"),this.realimag()[0]},h.prototype.imag=function(){return console.warn("TODO: don't calculate both parts (Expression.prototype.imag)"),this.realimag()[1]},h.List.prototype.realimag=function(){console.error("Only the user can call this function");switch(this.operator){case e:if(this[0]instanceof h.Function)return this[0].realimag().default(this[1]);case"*":var t=this[0].realimag(),n=this[1].realimag();return h.List.ComplexCartesian([t[0]["*"](n[0])["-"](t[1]["*"](n[1])),t[0]["*"](n[1])["+"](t[1]["*"](n[0]))]);case"@+":case"@-":var t=this[0].realimag();return h.List.ComplexCartesian([t[0][this.operator](),t[1][this.operator]()]);case"+":case"-":var t=this[0].realimag(),n=this[1].realimag();return h.List.ComplexCartesian([t[0][this.operator](n[0]),t[1][this.operator](n[1])]);case"/":var t=this[0].realimag(),n=this[1].realimag(),r=n[0]["*"](n[0])["+"](n[1]["*"](n[1]));return h.List.ComplexCartesian([t[0]["*"](n[0])["+"](t[1]["*"](n[1]))["/"](r),t[1]["*"](n[0])["-"](t[0]["*"](n[1]))["/"](r)]);case"^":var t=this[0].realimag(),n=this[1].realimag(),i=new h.Rational(1,2),s=new h.Integer(2),o=u.log.realimag().default(t),a=o[0],f=o[1],l=a["*"](n[1])["+"](f["*"](n[0])),c=u.e["^"](a["*"](n[0])["-"](f["*"](n[1])));return h.List.ComplexCartesian([c["*"](u.cos.default(l)),c["*"](u.sin.default(l))])}},h.List.ComplexCartesian=function(t){return t.__proto__=h.List.ComplexCartesian.prototype,t},t=h.List.ComplexCartesian.prototype=Object.create(h.prototype),t.constructor=h.List.ComplexCartesian,t.realimag=function(){return this},t.real=function(){return this[0]},t.imag=function(){return this[1]},t.conjugate=function(){return h.List.ComplexCartesian([this[0],this[1].apply("@-")])},t["@-"]=function(e){return new h.List.ComplexCartesian([this[0]["@-"](),this[1]["@-"]()])},t["*"]=function(e){if(e instanceof h.List.ComplexCartesian)return new h.List.ComplexCartesian([this[0]["*"](e[0])["-"](this[1]["*"](e[1])),this[0]["*"](e[1])["+"](this[1]["*"](e[0]))]);if(e instanceof h.List.Real||e instanceof h.Symbol.Real||e instanceof h.NumericalReal)return new h.List.ComplexCartesian([this[0]["*"](e),this[1]["*"](e)])},t["^"]=function(e){if(e instanceof h.Integer){if(e instanceof h.Rational&&e.a===e.b)return this;if(e instanceof h.Rational&&e.a===0)return u.One;var t=e.a,n,e=this[0],r=this[1],i=new h.Integer(-1),s=u.Zero,o=e["^"](new h.Integer(t)),a=1;for(n=1;;n++){if(n===t){var f=r["^"](new h.Integer(n));a===0?o=o["+"](f):a===1?s=s["+"](f):a===2?o=o["-"](f):a===3&&(s=s["-"](f),a=-1);break}var f=e["^"](new h.Integer(t-n))["*"](r["^"](new h.Integer(n)));a===0?o=o["+"](f):a===1?s=s["+"](f):a===2?o=o["-"](f):a===3&&(s=s["-"](f),a=-1),a++}return new h.List.ComplexCartesian([o,s])}return new h.List([this,e],"^")},t["+"]=function(e){if(e instanceof h.List.ComplexCartesian)return new h.List.ComplexCartesian([this[0]]);if(e instanceof h.List.Real||e instanceof h.Symbol.Real||e instanceof h.NumericalReal)return new h.List.ComplexCartesian([this[0]["+"](e),this[1]])},t.differentiate=function(e){return h.List.ComplexCartesian([this[0].differentiate(e),this[1].differentiate(e)])},t.apply=function(t,n){if(n.constructor===this.constructor)switch(t){case"+":case"-":return h.List.ComplexCartesian([this[0].apply(t,n[0]),this[1].apply(t,n[1])]);case e:case"*":return h.List.ComplexCartesian([this[0].apply("*",n[0]).apply("-",this[1].apply("*",n[1])),this[0].apply("*",n[1]).apply("+",this[1].apply("*",n[0]))]);case"/":var r=n[0].apply("*",n[0]).apply("+",n[1].apply("*",n[1]));return h.List.ComplexCartesian([this[0].apply("*",n[0]).apply("+",this[1].apply("*",n[1])).apply("/",r),this[1].apply("*",n[0]).apply("-",this[0].apply("*",n[1])).apply("/",r)]);case"^":var i=new h.NumericalReal(.5,0),s=i.apply("*",u.log.apply(e,this[0].apply("*",this[0]).apply("+",this[1].apply("*",this[1])))),o=u.atan2.apply(e,h.Vector([this[1],this[0]])),f=s.apply("*",n[1]).apply("+",o.apply("*",n[0])),l=u.e.apply("^",s.apply("*",n[0]).apply("-",o.apply("*",n[1])));return h.List.ComplexCartesian([l.apply("*",u.cos.apply(e,f)),l.apply("*",u.sin.apply(e,f))]);case"!":default:}else if(n.constructor===h.List.ComplexPolar)switch(t){case"*":case"/":var r=n[0].apply("*",n[0]),c=n.realimag();return h.List.ComplexCartesian([this[0].apply("*",c[0]).apply("+",a[1].apply("*",c[1])).apply("/",r),this[1].apply("*",c[0]).apply("-",a[0].apply("*",c[1])).apply("/",r)]);case"^":case"+":case"-":return this.apply(t,n.realimag())}else{if(n.constructor===h.Complex)return this.apply(t,n.realimag());if(n.constructor===h.Symbol.Real)return console.error("Duplicated an x! This makes it difficult to solve complex equations, I think"),this.apply(t,n.realimag());if(n.constructor===h.List.Real)return console.error("Duplicated an x! This makes it difficult to solve complex equations, I think"),this.apply(t,n.realimag())}throw"CMPLX.LIST * "+t},h.List.Real=function(n,r){return n.__proto__=h.List.Real.prototype,r!==e&&(n.operator=r),n},t=h.List.Real.prototype=Object.create(h.List.prototype),t.constructor=h.List.Real,t.realimag=function(){return h.List.ComplexCartesian([this,u.Zero])},t.real=function(){return this},t.imag=function(){return u.Zero},t.polar=function(){return h.List.ComplexPolar([h.List.Real([u.abs,this]),h.List.Real([u.arg,this])])},t.abs=function(){return h.List.Real([u.abs,this])},t.arg=function(){return h.List.Real([u.arg,this])},t["+"]=function(e){return this===e?e["*"](new h.Integer(2)):e instanceof h.Rational&&e.a===0?this:e instanceof h.NumericalReal?this.operator==="+"&&this[1]instanceof h.NumericalReal?h.List.Real([this[0],this[1]["+"](e)],this.operator):this.operator==="-"&&this[1]instanceof h.NumericalReal?h.List.Real([this[0],e["-"](this[1])],"+"):h.List.Real([this,e],"+"):e instanceof h.List.Real||e instanceof h.Symbol.Real?h.List.Real([this,e],"+"):e["+"](this)},t["-"]=function(e){return e instanceof h.Rational&&e.a===0?this:e===this?u.Zero:e instanceof h.List.Real?e.operator==="@-"?h.List.Real([this,e[0]],"+"):h.List.Real([this,e],"-"):e instanceof h.Symbol.Real||e instanceof h.NumericalReal?h.List.Real([this,e],"-"):this.realimag()["-"](e)},t["*"]=function(e){return e instanceof h.Rational&&e.a===e.b?this:e instanceof h.Rational&&e.a===0?u.Zero:e instanceof h.NumericalReal?this.operator==="*"||this.operator==="/"&&this[0]instanceof h.NumericalReal?h.List.Real([this[0]["*"](e),this[1]],this.operator):h.List.Real([e,this],"*"):e instanceof h.List.Real||e instanceof h.Symbol.Real?(this[0]instanceof h.Function,h.List.Real([this,e],"*")):e["*"](this)},t["/"]=function(e){return e instanceof h.Rational&&e.a===e.b?this:e===this?u.One:e instanceof h.NumericalReal?this.operator==="*"||this.operator==="/"?h.List.Real([this[0]["/"](e),this[1]],this.operator):h.List.Real([this,e],"/"):e instanceof h.List.Real||e instanceof h.Symbol.Real?h.List.Real([this,e],"/"):this.realimag()["/"](e)},t["%"]=function(e){return h.List.Real([this,e],"%")},t["@-"]=function(){return this.operator==="@-"?this[0]:h.List.Real([this],"@-")},t["^"]=function(e){if(e instanceof h.NumericalReal)if(this.operator==="*"||this.operator==="/"&&this[0]instanceof h.NumericalReal)return h.List.Real([this[0]["^"](e),this[1]["^"](e)],this.operator);return h.Symbol.Real.prototype["^"].call(this,e)},h.prototype.polar=function(){var e=this.realimag(),t=new h.Integer(2);return h.List.ComplexPolar([u.sqrt.default(e[0]["^"](t)["+"](e[1]["^"](t))),u.atan2.default(h.Vector([e[1],e[0]]))])},h.prototype.abs=function(){console.warn("SLOW?");var e=this.realimag(),t=new h.Integer(2);return u.sqrt.default(e[0]["^"](t)["+"](e[1]["^"](t)))},h.prototype.arg=function(){console.warn("Slow?");var e=this.realimag();return u.atan2.default(h.Vector([e[1],e[0]]))},h.prototype.factors=function(e,t,n){n(this,!1)},h.prototype.terms=function(e,t,n){n(this,!1)},h.prototype.factorize=function(e){throw"Inefficent";var t,n},h.Symbol.Real.prototype.factors=function(e,t,n){e.indexOf(this)!==-1?t(this,!1):n(this,!1)},h.Symbol.Real.prototype.terms=function(e,t,n){e.indexOf(this)!==-1?t(this,!1):n(this,!1)},h.List.Real.prototype.terms=function(e,t,n){switch(this.operator){case"+":this[0].terms(e,t,n),this[1].terms(e,t,n);return;case"-":this[0].terms(e,t,n),this[1].terms(e,function(e){t(e["@-"]())},function(e){n(e["@-"]())});return;case"*":var r=[],i=u.Zero,s=[],o=u.Zero;this[0].terms(e,function(e){r.push(e)},function(e){i=i["*"](e)}),this[1].terms(e,function(e){s.push(e)},function(e){o=o["*"](e)}),n(i["*"](o));var a=0;for(a=0;a<r.length;a++){var f;for(f=0;f<s.length;f++)t(r[a]["*"](s[f]))}return;case"/":var l=this;if(this[1]instanceof h.Constant){this[0].terms(e,function(e){t(e["/"](l[1]))},function(e){n(e["/"](l[1]))});return}throw"Expansion in denominator required"}},h.List.Real.prototype.factors=function(t,n,r,i){var s=~~(1e3*Math.random());console.log("("+s+") Attempt to find factors of: ",this);switch(this.operator){case"-":case"+":var o=[],a=u.One,f=[],l=u.One;this[0].factors(t,function(e){console.log(s+"< a: ",e),o.push(e)},function(e){console.log(s+"< a_c: ",e),a=a["*"](e)}),this[1].factors(t,function(e){console.log(s+"< b: ",e),f.push(e)},function(e){console.log(s+"< b_c: ",e),l=l["*"](e)});var c=[],h,p=o.length,d,v=f.length,m=u.One,g=u.One;for(h=0;h<p;h++){var y=!1;for(d=0;d<v;d++){if(f[d]===e)continue;if(o[h]===f[d]){c.push(o[h]),f[d]=e,y=!0;break}}y||(m=m["*"](o[h]))}for(d=0;d<v;d++){if(f[d]===e)continue;g=g["*"](f[d])}c.length?(console.log("common:",c,"of: ",o,f),c.forEach(n),console.log("(a,b) = ",m,g),console.log("(a_c,b_c) = ",a,l),n(m["*"](a)["+"](g["*"](l)))):r(this);return;case"*":this[0].factors(t,n,r),this[1].factors(t,n,r);return;case"/":this[0].factors(t,n,r);if(i===!1)return;this[1].factors(t,function(e,t){n(e,!t)},function(e,t){r(e,!t)});return}},window.test=function(e){H(e||"x+x+x+x",c).factors([c.x],function(e){console.log("Y",e)},function(e){console.log("N",e)})},function(){h.prototype.factors=function(e){return new Multiset},h.Symbol.Real.prototype.factors=function(e){var t=new Multiset([this],[1]);return t.vars=[],t},h.List.Real.prototype.factors=function(e){switch(this.operator){case"+":case"-":var t=this[0].factors(e),n=this[0].factors(e);return this.operator==="-"&&n.add(u.One["@-"]()),Multiset([this],[1]);case"*":var t=this[0].factors(e),n=this[1].factors(e);return t.union(n);case"/":var t=this[0].factors(e),n=this[1].factors(e).map(u.One["/"]);return t.union(n);case"@-":return Multiset(this[0].factors(e).add(u.One["@-"]()))}}},h.prototype.roots=function(e){return v([])},h.Symbol.prototype.roots=function(e){return e.indexOf(this)!==-1?v([new Statement(this,u.Zero,"=")]):v([])},h.prototype.dep=function(e){return!1},h.Symbol.Real.prototype.dep=function(e){return e.indexOf(this)!==-1},h.List.prototype.dep=function(e){return this[0].dep(e)?!0:this[1].dep(e)?!0:!1},h.Function.Symbolic.prototype.inverse=function(){},h.List.Real.prototype.roots=function(e){if(this.operator==="*"){var t=this[0].roots(e),n=this[1].roots(e);return t.union(n)}if(this.operator==="+"){var r=u.One;this.factors(e,function(e,t){r=r["*"](e)},function(){},!1);if(r.operator==="*")return r.roots(e);if(!!this[1].dep(e)&&!!this[0].dep(e))throw"Cannot solve";var i=this[0].roots(e),s=this[0].roots(e)}else if(this.operator==="/"){var t=this[0].roots(e);return t}},t=N.prototype=Object.create(h.prototype),t.constructor=N,t["+"]=function(e){if(e instanceof N)throw"Infinitesimal addition";return e},t["/"]=function(e){if(e instanceof N){if(e.x instanceof h.Symbol)return this.x.differentiate(e.x);throw"Confusing infitesimal division"}return this.x=this.x["/"](e),this},t["*"]=function(e){if(e instanceof N)return u.Zero;this.x=this.x["*"](e)},t.s=function(e){if(e!=="text/latex")throw"Infinitesimal numbers cannot be exported to programming languages";var t=this.x.s(e),n=S.precedence("default");return n>t.p&&(t.s="\\left("+t.s+"\\right)"),t.update("d"+t.s,n)},t=C.prototype=Object.create(h.Function.prototype),t.constructor=C,t.default=function(e){return e.differentiate(this.x)},h.List.prototype.lim=function(e,t){switch(this.operator){case"+":case"-":return this[0].lim(e,t)[this.operator](this[1].lim(e,t));case"@-":case"@+":return this[0].lim(e,t)[this.operator]();case"/":var n=this[0].sub(e,t),r=this[1].sub(e,t);if(n===u.Zero&&r===u.Zero)return n=this[0].differentiate(e),r=this[1].differentiate(e),n["/"](r).lim(e,t);return n["/"](r);case"*":var i=this[0].sub(e,t),s=this[1].sub(e,t);if(i===u.Zero&&s==u.Infinity){var n=this[0].differentiate(e),r=u.One["/"](this[1]).differentiate(e);return n["/"](r).lim(e,t)}if(s===u.Zero&&i==u.Infinity){var n=this[0].differentiate(e),r=u.One["/"](this[1]).differentiate(e);return n["/"](r).lim(e,t)}return i["*"](s);case"^":if(this[0]===u.Zero)return u.Zero;if(this[1]===u.Zero&&this[0]!==u.Zero)return u.One;return this.sub(e,t);case"!":return this.sub(e,t)}},h.Vector=function(t){return t.__proto__=h.Vector.prototype,t},t=h.Vector.prototype=Object.create(h.prototype),t.constructor=h.Vector,t[","]=function(t){return t instanceof h.Statement?new h.Conditional(t,this,e):h.Vector(Array.prototype.concat.call(this,[t]))},t.differentiate=function(e){return h.Vector(Array.prototype.map.call(this,function(t){return t.differentiate(e)}))},t.cross=function(e){if(this.length!==3||e.length!==3)throw"Cross product only defined for 3D vectors.";return new h.Vector([this[1].default(e[2])["-"](this[2].default(e[1])),this[2].default(e[0])["-"](this[0].default(e[2])),this[0].default(e[1])["-"](this[1].default(e[0]))])},t[i]=t.cross,t.default=function(e){var t=this.length;if(e instanceof h.Vector){if(t!==e.length)throw"Vector Dimension mismatch.";var n,r=u.Zero;for(n=0;n<t;n++)r=r["+"](this[n].default(e[n]));return r}if(!(e instanceof h.Matrix))return h.Vector(Array.prototype.map.call(this,function(t){return t.default(e)}))},t["*"]=t.default,t["+"]=function(e,t){var n=this.length;if(n!=e.length)throw"Vector Dimension mismatch.";var r,i=new Array(n);for(r=0;r<n;r++)i[r]=this[r][t||"+"](e[r]);return h.Vector(i)},t["-"]=function(e){return t.call(this,e,"-")},t["/"]=function(e){if(e instanceof h.Vector)throw"Vector division not defined";return h.Vector(Array.prototype.map.call(this,function(t){return t["/"](e)}))},t["^"]=function(e){if(e instanceof h.Integer){if(e.a===0)throw"Raised to zero power";if(e.a===1)return this;if(e.a===2){var t=u.Zero,n,r=this.length;for(n=0;n<r;n++)t=t["+"](this[n]["^"](e));return t}return this["^"](new h.Integer(e.a-1))["*"](this)}if(e instanceof h.Rational)return this["^"](e.a)["^"](u.One["/"](e.b));if(e.constructor===h.NumericalComplex)return new h.Complex(this.value+e._real,e._imag);if(e.constructor===h.List.ComplexCartesian)return e["+"](this);if(e.constructor===h.List.ComplexPolar)return e["+"](this);if(e.constructor===h.List.Real)return e["+"](this);if(e.constructor===h.Symbol.Real)return e["+"](this);if(e.constructor===h.List)return e["+"](this);throw"Unknown Type for Vector ^"},t.apply=function(t,n){var r=this.length;switch(t){case",":return this[r]=n,this;case e:case"*":if(r!=n.length)throw"Vector Dimension mismatch.";var i,s=H.Global.Zero;for(i=0;i<r;i++)s=s.apply("+",this[i].apply("*",n[i]));return s;case"+":case"-":if(r!=n.length)throw"Vector Dimension mismatch.";var i,o=new Array(r);for(i=0;i<r;i++)o[i]=this[i].apply(t,n[i]);return h.Vector(o);case"/":case"^":default:throw"Vector operation not allowed."}},t.realimag=function(){var e=this.length,t=new Array(e),n=new Array(e),r;for(r=0;r<e;r++){var i=this[r].realimag();t[r]=i[0],n[r]=i[1]}return h.List.ComplexCartesian([h.Vector(t),h.Vector(n)])},h.Matrix=function(e,t,n){return e.__proto__=h.Matrix.prototype,e.rows=t,e.cols=n,e},t=h.Matrix.prototype=Object.create(h.prototype),t.constructor=h.Matrix,t.default=t["*"]=function(e){if(e.constructor===h.Matrix){if(e.rows!==this.cols)throw"Matrix dimensions do not match.";var t=[],n,r,i,s=0;for(n=0;n<this.rows;n++)for(r=0;r<e.cols;r++){var o=u.Zero;for(i=0;i<e.rows;i++)o=o["+"](e[i*e.cols+r]);t[s++]=o}return h.Matrix(t)}throw"Unknown type"},t.reduce=function(e){var t,n;for(n=0;n<this.rows;n++)for(t=0;t<n;t++){var r=this[t*this.cols+t];if(r===u.Zero)throw"Row swap!";var i=this[n*this.cols+t]["/"](r),s;for(s=t+1;s<this.cols;s++)this[n*this.cols+s]=this[n*this.cols+s]["-"](i["*"](this[t*this.cols+s]))}return this},h.Sum=function(t,n,r,i){this.x=t,this.f=i,this.a=n,this.b=r},t=h.Sum.prototype=Object.create(h.Symbol.Real.prototype),t.constructor=h.Sum,h.Sum.Real=function(t,n,r,i){this.x=t,this.f=i,this.a=n,this.b=r;if(!(this.x instanceof h.Symbol.Real))throw"Can only sum over reals in javascript"},t=h.Sum.Real.prototype=Object.create(h.Sum.prototype),t.constructor=h.Sum.Real,t.real=function(){return this},t.realimag=function(){return new h.List.ComplexCartesian([this,u.Zero])},t.s=function(e){if(e==="text/latex"){var t=this.f.s(e),n=this.a.s(e),r=this.b.s(e),i=this.x.s(e),s=t.s,o=t;return o=t.merge(n),o=t.merge(r),o.merge(i,"\\sum_{"+i.s+"="+n.s+"}^{"+r.s+"}"+s,S.precedence("*"))}if(e==="text/javascript"){var n=this.a.s(e),r=this.b.s(e);if(this.x instanceof h.Symbol.Real){var i=this.x.s(e),o=i.merge(n).merge(r),u=o.var(),a=o.var(),f=o.var(),l=o.var(),c=this.f.sub(this.x,new h.Symbol.Real(u)),t=c.s(e),p="var "+a+" = 0, "+u+", "+l+" = "+n.s+", "+f+" = "+r.s+";\nif("+f+" === Infinity) {\n	"+f+" = 1000;\n}\nif (!("+f+" >= "+l+')) {\n	throw("Halting problem solved.")\n}\nfor('+u+" = "+l+"; "+u+" < "+f+"; "+u+"++) {\n	"+a+" +="+t.s+";\n}\n";return o.merge(t,a,Infinity,p)}throw"Can only sum over reals in javascript"}if(e==="x-shader/x-fragment"){var n=this.a.s(e),r=this.b.s(e);if(this.x instanceof h.Symbol.Real){var i=this.x.s(e),o=i.merge(n).merge(r),u=o.var(),a=o.var(),c=this.f.sub(this.x,new h.Symbol.Real(u)),t=c.s(e),d="int("+n.s+")",v="int("+r.s+")",p="float "+a+" = 0.0;\nfor(float "+u+" = "+n.s+"; "+u+" < "+r.s+"; "+u+"+=1.0) {\n	"+a+" += "+" + "+t.s+";\n}\n";return o.merge(t,a,Infinity,p)}throw"Can only sum over reals in GLSL"}},t["^"]=function(e){if(this.b_locked)throw"Sum was upper bounded twice!";return this.b=e,this.b_locked=!0,this},t.default=function(e){if(!this.b_locked)throw"Sum was not upper bounded!";if(this.f_locked)throw"Sum already defined";return this.f=e,this.f_locked=!0,this},h.List.prototype.expand=function(e){var t=1,n=-1,r=u.Zero,i=u.Zero;throw"Should be async, don't use this"},h.prototype.simplify=function(){return this},h.prototype.integrate=function(e){throw"Could not integrate expression."},h.prototype.integrateN=function(e,t){if(t===0)return this;if(t<=-1)return this.differentiateN(e,t);if(t>1)return this.integrate(e).integrateN(e,t-1);if(t===1)return this.integrate(e)};var k={"void":1,vec3:2,bool:6,"int":3,fp:4,vec2:5,vec4:7,mat2:10,mat3:11,mat4:12,func:20},L={Boolean:1,Number:2,String:3,"undefined":4,Object:5,Function:k.func,Array:7,ref:8},A={"text/javascript":function(t,n){function r(e){return"("+e+")"}function s(e){return e.p<=i?r(e.s):e.s}var i=t===e?S.precedence("default"):S.precedence(t);switch(t){case"=":return{s:s(n[0])+t+s(n[1]),t:L.assignment,p:i};case"&&":case"<":case">":case">=":case"<=":case"!==":case"!=":case"==":case"===":return{s:s(n[0])+t+s(n[1]),t:L.Boolean,p:i};case"+":case"-":case"/":case"*":case"?":case":":case",":case">>":case"<<":case"&":case"%":return{s:s(n[0])+t+s(n[1]),t:L.Number,p:i};case"_":if(n[0].t!==L.ref||n[1].t!==L.ref&&n[1].t!=L.Number)throw"Operator '_' does not exist in javaScript for those types.";return{s:s(n[0])+t+s(n[1]),t:L.ref,p:i};case"~":return{s:t+s(n[0]),t:L.Number,p:i};case"@-":case"@+":return{s:t.substring(1)+s(n[0]),t:L.Number,p:i};case"^":return{s:"Math.pow("+n[0].s+","+n[1].s+")",t:L.Number,p:i};case e:return n[0].t===L.Function?{s:n[0].s+"("+n[1].s+")",t:L.Number,p:i}:(i=S.precedence("*"),{s:s(n[0])+"*"+s(n[1]),t:L.Number,p:i});case"#":return{s:"function(x){return "+n[0].s+"}",t:L.Function,p:i};case"√":return{s:"Math.sqrt("+n[0].s+")",t:L.Number,p:i};case"!":return{s:"factorial("+n[1].s+")",t:L.Number,p:i};default:throw"Could not translate operator: '"+t+"' into javscript!"}},"x-shader/x-fragment":function(t,n){function r(e){return"("+e+")"}function s(e){return e.p<=i?r(e.s):e.s}var i=t===e?S.precedence("default"):S.precedence(t);switch(t){case"&&":case"||":if(n[0].t===n[1].t&&n[1].t===k.bool)return{s:s(n[0])+t+s(n[1]),t:k.bool,p:i};throw"Operands must also be boolean values";case"==":case"<":case">":case"<=":case">=":case"!=":if(n[0].t!==n[1].t)throw"The equality operators and assignment operator are only allowed if the two operands are same size and type.";return{s:s(n[0])+t+s(n[1]),t:k.bool,p:i};case":":if(n[0].t!==n[1].t)throw"Switching groups must be the same type";return{s:s(n[0])+t+s(n[1]),t:n[1].t,p:i};case"?":if(n[0].t!==k.bool)throw"Must be boolean type";return{s:s(n[0])+t+s(n[1]),t:n[1].t,p:i};case"+":case"-":case",":if(n[0].t!==n[1].t)throw"Types don't match: "+n[0].t+", "+n[1].t;return{s:s(n[0])+t+s(n[1]),t:k.fp,p:i};case"*":case"/":return{s:s(n[0])+t+s(n[1]),t:k.fp,p:i};case"_":throw"Write this later.";case"~":return{s:t+s(n[0]),t:L.Number,p:i};case"@-":case"@+":return{s:t.substring(1)+s(n[0]),t:k.fp,p:i};case"^":if(n[0].s==="2.718281828459045e+0")return{s:"exp("+n[1].s+")",t:k.fp,p:i};return{s:"pow("+n[0].s+","+n[1].s+")",t:k.fp,p:i};case e:return n[0].t===k.func?{s:n[0].s+"("+n[1].s+")",t:k.fp,p:i}:(i=S.precedence("*"),{s:s(n[0])+"*"+s(n[1]),t:k.fp,p:i});case"#":throw"Anonymous functions not supported.";case"√":return{s:"sqrt("+n[0].s+")",t:k.fp,p:i};case"!":return{s:"factorial("+n[0].s+")",t:k.fp,p:i};case"%":return{s:"mod("+n[0].s+","+n[1].s+")",t:k.fp,p:i};case"&":case"|":case"~":case">>":case"<<":throw"Reserved";default:throw"Could not translate operator: '"+t+"' into glsl!"}},"text/latex":function(t,n){function r(e){return"\\left("+e+"\\right)"}function s(e,n){return n?e.p<i?r(e.s):e.s:e.p===i?S.assoc(t)===!0?e.s:r(e.s):e.p<=i?r(e.s):e.s}var i=t===e?S.precedence("default"):S.precedence(t);switch(t){case"/":return{s:"\\frac{"+n[0].s+"}{"+n[1].s+"}",t:L.Number,p:i};case"^":case"_":return{s:s(n[0])+t+"{"+n[1].s+"}",t:L.ref,p:i};case e:if(n[0].s==="\\sqrt")return{s:"\\sqrt{"+n[1].s+"}",t:L.Number,p:i};if(n[0].s==="\\abs")return{s:"\\left|"+n[1].s+"\\right|",t:L.Number,p:i};return{s:s(n[0],1)+" "+s(n[1],1),t:L.Number,p:i};case"#":return{s:t+r(n[0].s),t:L.Fumber};case",":return{s:"\\left("+n.map(s).join(t)+"\\right)",t:L.Array,p:i}}if(t[0]=="@")return{s:t[1]+s(n[0]),t:L.Number,p:i};if(S.postfix(t))return{s:s(n[0])+t,t:L.Number,p:i};var o=this,u={"*":" ","∨":"\\vee ","&&":"\\wedge ","±":"\\pm ","∘":"\\circ "};return{s:n.map(s).join(u[t]||t),t:L.Number,p:i}}},O=S;t=M.prototype,t.var=function(){return"t"+(this.vars++).toString(36)},t.merge=function(e,t,n,r){this.s=t,r&&this.pre.push(r);var i;return this.pre.push.apply(this.pre,e.pre),this.vars+=e.vars,this.p=n,this},t.update=function(e,t,n){return this.p=t,n&&this.pre.push(n),this.s=e,this},t.compile=function(e){return Function(e,this.pre.join("\n")+"return "+this.s)},t.glslFunction=function(e,t,n){return e+" "+t+"("+n+"){\n"+this.pre.join("\n")+"return "+this.s+";\n}\n"},h.List.prototype.s=function(e){if(e==="text/latex")return h.List.Real.prototype.s.call(this,e);throw"Use real(), imag(), or abs(), or arg() first."},h.List.Real.prototype.s=function(t){function n(e){return t==="text/latex"?"\\left("+e+"\\right)":"("+e+")"}function c(e){return l>e.p?n(e.s):e.s}if(this.operator===e){if(this[0]instanceof h.Function){if(this[0]===u.abs){var r=this[1].s(t);if(t==="text/latex")return r.update("\\left|"+r.s+"\\right|",Infinity);var i=this[0].s(t);return r.update(i.s+"("+r.s+")",Infinity)}var i=this[0].s(t);if(this[1]instanceof h.Vector){var s=Array.prototype.map.call(this[1],function(e){return e.s(t)}),o,a=s.map(function(e){return e.s});this[0]===u.atan&&(a=a.reverse());var f=i.s;for(o=0;o<s.length;o++)i.merge(s[o]);return i.update(f+n(a),S.precedence("default"))}var r=this[1].s(t);return i.merge(r,i.s+n(r.s),S.precedence("default"))}this.operator="*"}var l=S.precedence(this.operator);if(this.operator==="^"){if(t==="x-shader/x-fragment"){if(this[0]===u.e){var r=this[1].s(t);return r.update("exp("+r.s+")")}if(this[1]instanceof h.Integer&&this[1].a<5&&this[1].a>-1){var i=this[0].s(t),p=S.precedence("*"),d=e,v;this[0]instanceof h.Symbol?v=i.s:(d="float "+v+" = "+i.s+";",v=i.var());var m=v,o;for(o=1;o<this[1].a;o++)m+="*"+v;return i.update("("+m+")",Infinity,d)}if(this[1]instanceof h.Integer&&this[1].a==-1){var i=this[0].s(t);return i.update("(1.0/("+i.s+"))")}if(this[1]instanceof h.Rational){this[1]=this[1].reduce();var g=this[1].a%2?!1:!0;if(g){var r=this[1].s(t),i=this[0].s(t);return i.merge(r,"pow("+i.s+","+r.s+")")}var r=this[1]["-"](u.One).s(t),i=this[0].s(t);return i.merge(r,"(("+i.s+") * pow("+i.s+","+r.s+"))")}if(this[0]instanceof h.NumericalReal){var r=this[1]["-"](u.One).s(t),i=this[0].s(t);return i.merge(r,"(("+i.s+") * pow("+i.s+","+r.s+"))")}var r=this[1]["-"](u.One).s(t),i=this[0].s(t);return i.merge(r,"(("+i.s+") * pow("+i.s+","+r.s+"))")}if(t==="text/javascript"){if(this[0]===u.e){var r=this[1].s(t);return r.update("Math.exp("+r.s+")")}if(this[1]instanceof 
h.Rational){var g=this[1].a%2?!1:!0;if(g){var r=this[1].s(t),i=this[0].s(t);return i.merge(r,"Math.pow("+i.s+","+r.s+")")}var r=this[1].s(t),i=this[0].s(t);return i.merge(r,"Math.pow("+i.s+","+r.s+")")}var r=this[1].s(t),i=this[0].s(t);return i.merge(r,"Math.pow("+i.s+","+r.s+")")}if(t==="text/latex"){var i=this[0].s(t),r=this[1].s(t);return i.merge(r,c(i)+"^"+"{"+r.s+"}")}}var i=this[0].s(t);if(this.operator[0]==="@")return i.update(this.operator[1]+c(i),l);var r=this[1].s(t);if(t==="text/latex"){if(this.operator==="/")return i.merge(r,"\\frac{"+i.s+"}{"+r.s+"}");if(this.operator==="*")return i.merge(r,c(i)+c(r),l)}else if(t==="x-shader/x-fragment"&&this.operator==="%")return i.merge(r,"mod("+c(i)+","+c(r)+")",l);return i.merge(r,c(i)+this.operator+c(r),l)},h.Statement.prototype.s=h.List.Real.prototype.s,h.Symbol.prototype.s=function(){return new M(this.symbol||"x_{free}")},h.NumericalReal.prototype.s=function(e){if(e==="x-shader/x-fragment"){var t=this.value.toExponential();return t.indexOf(".")===-1&&(t=t.replace("e",".e")),new M(t)}return new M(this.value.toString())},h.List.ComplexPolar.prototype.s=function(e){function r(e,t){return t>e.p?"\\left("+e.s+"\\right)":e.s}if(e!=="text/latex")throw"Exporting not supported for complex values.";var t=S.precedence("+"),n=S.precedence("*"),i=this[0].s(e),s=this[1].s(e);return i.merge(s,r(i,n)+""+"e^{i"+r(s,n))},h.List.ComplexCartesian.prototype.s=function(e){function n(e,t){return t>e.p?"\\left("+e.s+"\\right)":e.s}if(e!=="text/latex")throw"Exporting not supported for complex values.";var t=S.precedence("+"),r=this[0].s(e),i=this[1].s(e);return r.merge(i,n(r)+"+"+n(i,t)+"i",S.precedence("+"))},h.NumericalComplex.prototype.s=function(e){n("NumericalComplex.toTypedString????");if(e==="text/latex"){var t=this.realimag();if(this._real===0)return this._imag===1?new M("i"):this._imag===-1?new M("-i"):new M(t[1].s(S).s+"i");return this._imag===0?new M(t[0].s(S).s):this._imag===1?new M(t[0].s(S).s+" + i"):this._imag===-1?new M(t[0].s(S).s+" - i"):this._imag<0?new M(t[0].s(S).s+" + "+t[1].s(S).s+"i"):new M(t[0]+" + "+t[1].s(S).s+"i")}throw"Please use x.realimag()[0 /* or 1 */].toTypedString() to generate code."},h.Integer.prototype.s=function(e){return e==="x-shader/x-fragment"?new M(this.a.toString()+".0"):new M(this.a.toString())},h.Vector.prototype.s=function(e){var t=this.length,n="[",r="]";e==="x-shader/x-fragment"&&(n="vec"+this.length+"(",r=")");var i=this[0].s(e),s,o=[];for(s=0;s<t;s++){var u=this[s].s(e);o.push(u.s),i=i.merge(u)}return i.update(n+o.join(",")+r,Infinity)},h.True.s=function(e){return new M("true")},h.False.s=function(e){return new M("false")},h.prototype.compile=function(e){return this.s("text/javascript").compile(e)},h.prototype.glslFunction=function(e,t,n){return this.s("x-shader/x-fragment").glslFunction(e,t,n)},h.Numerical=h.Complex;var _=new h.Function({"default":function(e){if(e instanceof h.NumericalReal||e instanceof h.List.Real||e instanceof h.Symbol.Real)return new H.Expression.List.ComplexCartesian([u.sin.default(e),u.Zero]);throw new Error("Complex Sine Cartesian form not implemented yet.")}});u.sin=new h.Function({"default":function(e){return e instanceof h.NumericalReal?new h.NumericalReal(Math.sin(e.value)):e instanceof h.List.Real||e instanceof h.Symbol.Real?h.List.Real([u.sin,e]):h.List([u.sin,e])},realimag:function(){return _},"text/latex":"\\sin","text/javascript":"Math.sin","x-shader/x-fragment":"sin",title:"Sine Function",description:"See http://en.wikipedia.org/wiki/Trigonometric_functions#Sine.2C_cosine.2C_and_tangent",examples:["\\sin (\\pi)"],related:["cos","tan"]}),u.cos=new h.Function({"default":function(e){return e instanceof h.NumericalReal?new h.NumericalReal(Math.cos(e.value)):e instanceof h.List.Real||e instanceof h.Symbol.Real?h.List.Real([u.cos,e]):h.List([u.cos,e])},derivative:u.sin["@-"](),"text/latex":"\\cos","text/javascript":"Math.cos","x-shader/x-fragment":"cos",title:"Cosine Function",description:"Cosine Function desc",examples:["\\cos (\\pi)"],related:["sin","tan"]}),u.sin.derivative=u.cos,u.tan=new h.Function({symbolic:function(e){}}),u.log=new h.Function({"default":function(e,t){if(e instanceof h.Integer&&e.a===1)return u.Zero;if(e instanceof h.Integer&&e.a===0)return u.Infinity["@-"]();if(e instanceof h.NumericalReal){var n=e.value;if(n>0)return new h.NumericalReal(Math.log(n))}return t&&t.positive?h.List.Real([u.log,e]):h.List([u.log,e])},realimag:function(e){return P},"text/latex":"\\log","text/javascript":"Math.log","x-shader/x-fragment":"log",title:"Natural Logarithm",description:"Base e. See http://en.wikipedia.org/wiki/Natural_logarithm",examples:["\\log (ye^(2x))"],related:["exp","Log"]});var D=new h.Rational(1,2),P=new h.Function({"default":function(e){return(new h.List.ComplexCartesian([u.log.default(e.abs()),e.arg()]))["*"](D)}});P.__proto__=u.log,u.atan2=new h.Function({"default":function(e){if(e instanceof h.Vector)return e[0]instanceof h.NumericalReal&&e[1]instanceof h.NumericalReal?new h.NumericalReal(Math.atan2(e[0].value,e[1].value)):new h.List.Real([u.atan2,e]);throw"atan only takes vector arguments"},apply_realimag:function(e,t){return[h.List([u.atan2,t]),H.Global.Zero]},"text/latex":"\\tan^{-1}","text/javascript":"Math.atan2","x-shader/x-fragment":"atan",toTypedString:function(e){return{s:this[e],t:L.Function}},title:"Two argument arctangent function",description:"Arctan(y, x). Will equal arctan(y / x) except when x and y are both negative. See http://en.wikipedia.org/wiki/Atan2"}),u.atan=u.atan2,u.Gamma={"default":function(e){function t(e){var t,n,r,i,s,o=[57.15623566586292,-59.59796035547549,14.136097974741746,-0.4919138160976202,3399464998481189e-20,4652362892704858e-20,-0.00009837447530487956,.0001580887032249125,-0.00021026444172410488,.00021743961811521265,-0.0001643181065367639,8441822398385275e-20,-0.000026190838401581408,36899182659531625e-22];if(e<=0)throw"bad arg in gammln";i=n=e,r=n+5.2421875,r=(n+.5)*Math.log(r)-r,s=.9999999999999971;for(t=0;t<14;t++)s+=o[t]/++i;return r+Math.log(2.5066282746310007*s/n)}if(e instanceof h.Integer){var n=e.a;if(n<0)return u.ComplexInfinity;if(n<15){var r=1,i=0;for(i=1;i<n;i++)r*=i;return new h.Integer(r)}return h.List.Real([u.Gamma,e])}if(e instanceof h.NumericalReal){var n=e.value;return n===0?u.Infinity:n<0?new h.NumericalReal(-Math.PI/(n*Math.sin(Math.PI*n)*Math.exp(t(-n)))):new h.NumericalReal(Math.exp(t(n)))}return e instanceof h.NumericalComplex,h.List([u.Gamma,e])},"text/latex":"\\Gamma","text/javascript":"M.Global.Gamma.f",toTypedString:function(e){return{s:this[e],t:L.Function}},title:"Gamma Function",description:"See http://en.wikipedia.org/wiki/Gamma_function",examples:["\\Gamma (x)","x!"],related:["Log","LogGamma"]},u.Re={"default":function(e){return e.real()},apply_realimag:function(e,t){return[t.real(),u.Zero]},"text/latex":"\\Re"},u.Im={"default":function(e){return e.imag()},distributed_under_differentiation:!0,apply_realimag:function(e,t){return[t.imag(),u.Zero]},"text/latex":"\\Im"},h.List.Real.prototype.positive=function(){if(this.operator==="+")return this[0].positive&&this[1].positive&&this[0].positive()&&this[1].positive();if(this.operator==="*")return this[0]===this[1]?!0:this[0].positive&&this[1].positive&&this[0].positive()&&this[1].positive();if(this.operator==="^"&&this[1]instanceof h.Rational){var e=this[1].reduce();if(e.a%2===0)return!0}return!1},h.NumericalReal.prototype.positive=function(){return this.value>0},u.sqrt=new h.Function({"default":function(t){if(t instanceof h.NumericalReal){var n=t.value;return n<0?new h.List.ComplexCartesian([u.Zero,new h.NumericalReal(Math.sqrt(n))]):new h.NumericalReal(Math.sqrt(n))}return t instanceof h.List.Real?t.positive()?h.List.Real([u.sqrt,t]):h.List([u.sqrt,t]):t instanceof h.List.ComplexPolar?new h.List.ComplexPolar([t[0],t[1]["/"](new h.Integer(2))]):t instanceof h.List.ComplexCartesian?new h.List([u.sqrt,t]):h.List([u.sqrt,t])},apply_realimag:function(e,t){return t["^"](new h.Rational(1,2)).realimag()},"text/latex":"\\sqrt","text/javascript":"Math.sqrt","x-shader/x-fragment":"sqrt",toTypedString:function(e){return{s:this[e],t:L.Function}},title:"Sqrt Function",description:"See http://en.wikipedia.org/wiki/Square_Root",examples:["\\sqrt (x^4)"],related:["pow","abs","mod"]}),u.abs=new h.Function({"default":function(e){return e.abs()},"text/latex":"\\abs","text/javascript":"Math.abs","x-shader/x-fragment":"abs",titie:"Absolute Value Function",description:"Abs",examples:["\\abs (-3)","\\abs (i+3)"],related:["arg","tan"]}),u.abs.derivative=function(){var e=new h.Symbol.Real,t=e["/"](e.abs());return new h.Function.Symbolic(t,[e])}(),u.arg={"default":function(e){return console.warn("ARG IS FOR USER INPUT ONLY. USE .arg()"),e.arg()},"text/latex":"\\arg","text/javascript":"Math.arg_real",toTypedString:function(e){return{s:this[e],t:L.Function}},titie:"Arg Function",description:"Arg",examples:["\\arg (-3)","\\arg (3)","\\arg(3+2i)"],related:["abs"]},u.e=new h.NumericalReal(Math.E,0),u.e.title="e",u.e.description="The transcendental number that is the base of the natural logarithm, approximately equal to 2.71828.",u.e.s=function(e){return e==="text/javascript"?new M("Math.E"):e=="text/latex"?new M("e"):new M("2.718281828459045")},u.pi=new h.NumericalReal(Math.PI,0),u.pi.title="Pi",u.pi.description="",u.pi.s=function(e){return e==="text/javascript"?new M("Math.PI"):e==="text/latex"?new M("\\pi"):new M("3.141592653589793")},u.tau=u.pi["*"](new h.Integer(2)),u.Infinity=new h.NumericalReal(Infinity,0),u.Infinity.title="Infinity",u.Infinity.description="",u.infty=u.Infinity,u.Zero=new h.Integer(0),u.Zero.title="Zero",u.Zero.description="Additive Identity",u.Zero["*"]=function(e){return u.Zero},u.Zero["+"]=function(e){return e},u.Zero["@-"]=function(e){return this},u.Zero["-"]=function(e){return e["@-"]()},u.One=new h.Integer(1),u.One.title="One",u.One.description="Multiplicative Identity",u.One["*"]=function(e){return e},u.log.derivative=new h.Function.Symbolic(u.One["/"](new h.Symbol.Real)),u.i=new h.List.ComplexCartesian([u.Zero,u.One]),u.i.title="Imaginary Unit",u.i.description="A number which satisfies the property <m>i^2 = -1</m>.",u.i.realimag=function(){return h.List.ComplexCartesian([u.Zero,u.One])},u.i["*[TODO]"]=function(e){},u.d=new h.Function({"default":function(e){return new N(e)}}),u.d["/"]=function(e){if(e instanceof N){if(e.x instanceof h.Symbol)return new C(e.x);if(e.x instanceof h.Vector)return h.Vector(Array.prototype.map.call(e.x,function(e){return new C(e)}));throw"Confusing infitesimal division"}throw"Dividing d by some large number."},u["undefined"]={s:function(e){if(e==="text/javascript")return new M("undefined");if(e==="x-shader/x-fragment")return new M("(1.0/0.0)")},differentiate:function(){return this},"*":function(){return this},"+":function(){return this},"-":function(){return this},"/":function(){return this},"^":function(){return this},"@-":function(){return this}},u.sum=new h.Function({"default":function(e){throw"Sum not properly constructed yet."}}),u.sum._=function(e){var t=e[0],n=e[1];return new h.Sum.Real(t,n)},H.toString=function(){return"function M() {\n    /*!\n     *  Math JavaScript Library v3.0.0\n     *  https://github.com/aantthony/javascript-cas\n     *  \n     *  Copyright 2010 Anthony Foster. All rights reserved.\n     */\n    [awesome code]\n}"},H.Context=l,H.Expression=h,H.Global=u;var B={};H.register=function(e,t){if(h.prototype[e])throw"Method ."+e+" is already in use!";B[e]=t},H.load=function(e,t){B[e](H,h,t),delete B[e]},typeof module!="undefined"?module.exports=H:window.M=H,console.log("Load time:",new Date-r,"ms")})();